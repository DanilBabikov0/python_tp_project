<!DOCTYPE html>
<html>
<head>
    <title>Простая проверка извлечения цветов</title>
</head>
<body>
    <h1>Тест извлечения цветов из изображения</h1>
    
    <form method="post" enctype="multipart/form-data" action="{% url 'extract_colors' %}">
        {% csrf_token %}
        
        <div>
            <label>Изображение:</label><br>
            <input type="file" name="image" accept="image/*" required>
        </div>
        
        <div style="margin: 15px 0;">
            <label>Количество цветов:</label><br>
            <input type="number" name="count" value="5" min="1" max="20">
        </div>
        
        <button type="submit">Извлечь цвета</button>
    </form>
    
    <hr>
    
    <div id="results" style="margin-top: 20px;">
        <!-- Результаты появятся здесь -->
    </div>
    
    <script>
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const form = e.target;
            const formData = new FormData(form);
            
            fetch(form.action, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('results');
                
                if (data.error) {
                    resultsDiv.innerHTML = `
                        <h3 style="color: red;">Ошибка:</h3>
                        <p>${data.error}</p>
                        ${data.error_type ? `<p>Тип ошибки: ${data.error_type}</p>` : ''}
                    `;
                } else {
                    let colorsHtml = '<h3>Найденные цвета:</h3>';
                    colorsHtml += '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
                    
                    data.colors.forEach(color => {
                        colorsHtml += `
                            <div style="
                                width: 100px; 
                                height: 100px; 
                                background-color: ${color};
                                border: 1px solid #ccc;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-weight: bold;
                                color: white;
                                text-shadow: 1px 1px 2px black;
                            ">
                                ${color}
                            </div>
                        `;
                    });
                    
                    colorsHtml += '</div>';
                    colorsHtml += `<p><strong>Количество:</strong> ${data.count} цветов</p>`;
                    colorsHtml += `<p><strong>Файл:</strong> ${data.filename}</p>`;
                    
                    resultsDiv.innerHTML = colorsHtml;
                }
            })
            .catch(error => {
                document.getElementById('results').innerHTML = `
                    <h3 style="color: red;">Ошибка сети:</h3>
                    <p>${error.message}</p>
                `;
            });
        });
    </script>
</body>
</html>